<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indosphere: The Grand Paramparā</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- AESTHETIC: THE COSMIC ARCHIVE --- */
        :root {
            --bg: #08090a; 
            --panel: #111214;
            --gold: #d4af37;
            --silver: #a5a5a5;
            --advaita: #ff9800; /* Saffron */
            --nyaya: #00bcd4;   /* Blue */
            --shaiva: #9c27b0;  /* Purple */
            --border: #252629;
        }

        body { background: var(--bg); color: #e0e0e0; margin: 0; font-family: 'Noto Serif', serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER & CONTROLS */
        header { 
            height: 70px; background: var(--panel); border-bottom: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.6); z-index: 20;
        }
        .brand { font-family: 'Cinzel', serif; font-size: 1.4rem; letter-spacing: 2px; color: var(--gold); text-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .brand span { color: #555; font-size: 0.7em; margin-left: 10px; font-weight: 400; letter-spacing: 1px; }

        .controls { display: flex; gap: 15px; align-items: center; }
        
        select {
            background: #1a1b1e; color: var(--gold); border: 1px solid var(--border); padding: 8px 15px;
            font-family: 'Cinzel', serif; font-size: 0.85rem; border-radius: 2px; outline: none; cursor: pointer;
        }
        
        #search { 
            background: #1a1b1e; border: 1px solid var(--border); color: #fff; padding: 8px 15px; 
            border-radius: 2px; width: 220px; font-family: 'Noto Serif', serif; transition: 0.3s;
        }
        #search:focus { border-color: var(--gold); width: 280px; outline: none; }

        /* MAIN CANVAS */
        .main-container { display: flex; flex: 1; position: relative; height: calc(100vh - 70px); }
        #mynetwork { flex-grow: 1; background: radial-gradient(circle at center, #16171a 0%, #000 140%); }

        /* SIDE PANEL - THE SCROLL */
        #side-panel {
            width: 0; background: var(--panel); border-left: 1px solid var(--border);
            transition: width 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; display: flex; flex-direction: column; z-index: 15;
            box-shadow: -10px 0 30px rgba(0,0,0,0.8);
        }
        
        .panel-content { padding: 40px; min-width: 350px; opacity: 0; transition: opacity 0.4s 0.2s; }
        
        .p-title { font-family: 'Cinzel', serif; font-size: 2rem; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 5px; line-height: 1.1; }
        .p-subtitle { font-size: 0.9rem; color: var(--silver); font-style: italic; margin-bottom: 25px; display: block; }
        
        .p-label { color: #555; font-family: 'Cinzel', serif; font-size: 0.75rem; letter-spacing: 1px; margin-top: 25px; display: block; }
        .p-value { font-size: 1.05rem; color: #ddd; line-height: 1.6; margin-top: 5px; font-weight: 300; }
        
        /* ETHNICITY STYLING */
        .eth-main { color: #fff; font-weight: 700; font-size: 1.1rem; }
        .eth-sub { color: var(--gold); font-style: italic; font-weight: 400; margin-left: 8px; font-family: 'Cinzel', serif; font-size: 1rem; }

        /* WORKS LIST */
        .works-list { margin-top: 5px; padding-left: 0; list-style: none; }
        .works-list li { margin-bottom: 4px; color: #ccc; font-size: 0.95rem; }
        .works-list li::before { content: "•"; color: var(--gold); display: inline-block; width: 1em; margin-left: -1em; }

        .lineage-box { border-left: 2px solid var(--gold); padding-left: 15px; margin-top: 10px; color: #ccc; font-style: italic; }

        /* TIMELINE */
        #mytimeline { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 140px; 
            background: rgba(17,18,20,0.95); border-top: 1px solid var(--border); z-index: 10;
        }
        
        /* IAST HIGHLIGHTS */
        .iast { font-style: italic; color: #e6c673; }
    </style>
</head>
<body>

<header>
    <div class="brand">Indosphere <span>The Grand Paramparā</span></div>
    <div class="controls">
        <select id="schoolFilter" onchange="filterNetwork()">
            <option value="all">All Schools (The Banyan Tree)</option>
            <option value="advaita">Advaita Vedānta</option>
            <option value="nyaya">Nyāya & Vaiśeṣika</option>
            <option value="kashmir">Kashmir Śaivism</option>
            <option value="bhakti">Bhakti Movement</option>
            <option value="grammar">Vyākaraṇa (Linguistics)</option>
            <option value="buddhism">Bauddha Dharma</option>
            <option value="west">Western Indophiles</option>
        </select>
        <input type="text" id="search" placeholder="Search (e.g. Śaṅkara)..." onkeyup="searchNode()">
    </div>
</header>

<div class="main-container">
    <div id="mynetwork"></div>
    
    <div id="side-panel">
        <div class="panel-content" id="panel-content">
            <div id="p-name" class="p-title"></div>
            <span id="p-dates" class="p-subtitle"></span>

            <span class="p-label">Origin / Region</span>
            <div id="p-ethnicity-container" class="p-value"></div>

            <span class="p-label">School / Tradition</span>
            <div id="p-school" class="p-value" style="color: var(--gold)"></div>

            <span class="p-label">Magnum Opus</span>
            <div id="p-work" class="p-value iast"></div>

            <span class="p-label">Other Significant Works</span>
            <ul id="p-other-works" class="works-list"></ul>

            <span class="p-label">Lineage Context</span>
            <div id="p-lineage" class="lineage-box"></div>

            <span class="p-label">Intellectual Contribution</span>
            <div id="p-note" class="p-value"></div>
        </div>
    </div>
</div>

<div id="mytimeline"></div>

<script type="text/javascript">

// --- 1. DATA WITH IAST & LINEAGE (350+ Entries) ---
// Generated from Python script.
const rawData = [
    // --- VEDIC & ANCIENT ---
    {id: "Dhanvantari", label: "Dhanvantari", iast: "Dhanvantari", year: -3000, school: "Ayurveda", region: "Vedic (Mythical)", ethnicity: "Indian", work: "Ayurveda (Source)", others: ["Dhanvantari Nighantu"], note: "Legendary God of Medicine and health."},
    {id: "Dirghatamas", label: "Dirghatamas", iast: "Dīrghatamas", year: -1500, school: "Vedas", region: "Anga / Magadha", ethnicity: "Indian", work: "Rig Veda (Hymns)", others: ["Asya Vamiya Hymn"], note: "Blind rishi, seer of the 'Riddle Hymn' of the Rig Veda."},
    {id: "Vyasa", label: "Vyāsa", iast: "Kṛṣṇa Dvaipāyana Vyāsa", year: -1500, school: "Vedas", region: "Kuru", ethnicity: "Indian", work: "Mahābhārata", others: ["Brahma Sutras", "Puranas"], note: "Compiler of the Vedas and the Great Epic."},
    {id: "Yajnavalkya", label: "Yājñavalkya", iast: "Yājñavalkya", year: -850, school: "Upanishads", region: "Videha (Mithila)", ethnicity: "Indian", work: "Bṛhadāraṇyaka Upaniṣad", others: ["Shatapatha Brahmana", "Yajnavalkya Smriti"], note: "Greatest sage of Shukla Yajurveda; expounded 'Neti Neti'."},
    {id: "Kapila", label: "Kapila", iast: "Kapila Muni", year: -600, school: "Samkhya", region: "Vedic", ethnicity: "Indian", work: "Sāṃkhya Sūtras", others: [], note: "Founder of Dualism (Puruṣa/Prakṛti)."},
    {id: "Gautama Buddha", label: "Buddha", iast: "Siddhārtha Gautama", year: -563, school: "buddhism", region: "Magadha", ethnicity: "Indian", work: "Pali Canon", others: ["Dhammapada"], note: "The Awakened One; Anātman and Nirvāṇa."},
    {id: "Panini", label: "Pāṇini", iast: "Pāṇini", year: -500, school: "grammar", region: "Gandhara", ethnicity: "Indian", work: "Aṣṭādhyāyī", others: ["Dhatupatha", "Ganapatha"], note: "Father of Linguistics; algorithmic grammar."},
    {id: "Kanada", label: "Kaṇāda", iast: "Kaṇāda", year: -200, school: "nyaya", region: "Gujarat", ethnicity: "Indian", work: "Vaiśeṣika Sūtra", others: [], note: "First Atomic Theorist (Aṇu)."},
    {id: "Patanjali", label: "Patañjali", iast: "Patañjali", year: -150, school: "yoga", region: "Gonarda", ethnicity: "Indian", work: "Yoga Sūtras", others: ["Mahabhasya"], note: "Codified the 8 limbs of Yoga."},
    {id: "Chanakya", label: "Chanakya", iast: "Cāṇakya", year: -350, school: "Statecraft", region: "Magadha", ethnicity: "Indian", work: "Arthaśāstra", others: ["Chanakya Niti"], note: "Master of Realpolitik and Economics."},
    
    // --- CLASSICAL ---
    {id: "Nagarjuna", label: "Nāgārjuna", iast: "Nāgārjuna", year: 150, school: "buddhism", region: "Andhra", ethnicity: "Indian", work: "Mūlamadhyamakakārikā", others: ["Ratnavali", "Suhrulekha"], note: "Founder of Śūnyatā (Emptiness)."},
    {id: "Kalidasa", label: "Kālidāsa", iast: "Kālidāsa", year: 400, school: "Literature", region: "Ujjain", ethnicity: "Indian", work: "Abhijñānaśākuntalam", others: ["Meghaduta", "Kumarasambhavam"], note: "Supreme Poet (Mahākavi) of Sanskrit."},
    {id: "Aryabhata", label: "Āryabhaṭa", iast: "Āryabhaṭa", year: 476, school: "Science", region: "Patna", ethnicity: "Indian", work: "Āryabhaṭīya", others: ["Arya-siddhanta"], note: "Calculated Zero, Pi, and Heliocentrism."},
    {id: "Dignaga", label: "Dignāga", iast: "Dignāga", year: 480, school: "buddhism", region: "Kanchipuram", ethnicity: "Indian", work: "Pramāṇa-samuccaya", others: ["Hetucakra"], note: "Father of Buddhist Logic."},
    {id: "Bhartrihari", label: "Bhartṛhari", iast: "Bhartṛhari", year: 450, school: "grammar", region: "Ujjain", ethnicity: "Indian", work: "Vākyapadīya", others: ["Shatakatraya"], note: "Philosopher of Language (Sphota)."},
    
    // --- ADVAITA LINEAGE ---
    {id: "Gaudapada", label: "Gauḍapāda", iast: "Gauḍapāda", year: 600, school: "advaita", region: "Kurukshetra", ethnicity: "Indian", work: "Māṇḍūkya Kārikā", others: [], note: "Grand-guru of Shankara; Ajātivāda theory."},
    {id: "Adi Shankara", label: "Śaṅkara", iast: "Ādi Śaṅkarācārya", year: 788, school: "advaita", region: "Kerala", ethnicity: "Indian", work: "Brahmasūtra Bhāṣya", others: ["Vivekachudamani", "Upadesasahasri", "Bhaja Govindam"], note: "Consolidator of Advaita Vedānta."},
    {id: "Suresvara", label: "Sureśvara", iast: "Sureśvara", year: 800, school: "advaita", region: "South", ethnicity: "Indian", work: "Naiṣkarmya Siddhi", others: ["Vartikas"], note: "Direct disciple of Shankara."},
    {id: "Vacaspati Misra", label: "Vācaspati", iast: "Vācaspati Miśra", year: 900, school: "advaita", region: "Mithila", ethnicity: "Indian", work: "Bhāmatī", others: ["Nyaya-Kanika"], note: "Polymath who wrote on all 6 Darśanas."},
    {id: "Vidyaranya", label: "Vidyāraṇya", iast: "Vidyāraṇya Mādhavācārya", year: 1296, school: "advaita", region: "Sringeri", ethnicity: "Indian", work: "Pañcadaśī", others: ["Sarvadarshanasamgraha"], note: "Patron saint of Vijayanagara Empire."},
    {id: "Madhusudana", label: "Madhusūdana", iast: "Madhusūdana Sarasvatī", year: 1540, school: "advaita", region: "Bengal", ethnicity: "Indian", work: "Advaita Siddhi", others: ["Gudhartha Dipika"], note: "Defended Monism against Logic."},

    // --- NYAYA & KASHMIR SHAIVISM ---
    {id: "Udayana", label: "Udayana", iast: "Udayanācārya", year: 984, school: "nyaya", region: "Mithila", ethnicity: "Indian", work: "Nyāyakusumāñjali", others: ["Atmatattvaviveka"], note: "Proved God through Logic."},
    {id: "Gangesa", label: "Gaṅgeśa", iast: "Gaṅgeśa Upādhyāya", year: 1325, school: "nyaya", region: "Mithila", ethnicity: "Indian", work: "Tattvacintāmaṇi", others: [], note: "Founder of Navya-Nyāya (New Logic)."},
    {id: "Abhinavagupta", label: "Abhinavagupta", iast: "Abhinavagupta", year: 950, school: "kashmir", region: "Kashmir", ethnicity: "Indian", work: "Tantrāloka", others: ["Abhinavabharati", "Paramarthasara"], note: "Greatest genius of Shaiva Tantra & Aesthetics."},
    {id: "Utpaladeva", label: "Utpaladeva", iast: "Utpaladeva", year: 925, school: "kashmir", region: "Kashmir", ethnicity: "Indian", work: "Īśvarapratyabhijñā", others: ["Sivastotravali"], note: "Architect of Recognition philosophy."},

    // --- VEDANTA SCHOOLS ---
    {id: "Ramanuja", label: "Rāmānuja", iast: "Rāmānuja", year: 1017, school: "bhakti", region: "Tamil Nadu", ethnicity: "Indian", work: "Śrī Bhāṣya", others: ["Vedartha Sangraha", "Gita Bhashya"], note: "Founder of Viśiṣṭādvaita (Qualified Non-Dualism)."},
    {id: "Madhvacharya", label: "Madhva", iast: "Madhvācārya", year: 1238, school: "bhakti", region: "Udupi", ethnicity: "Indian", work: "Sarvamūla", others: ["Mahabharata Tatparya Nirnaya"], note: "Founder of Dvaita (Dualism)."},
    {id: "Chaitanya", label: "Caitanya", iast: "Śrī Caitanya Mahāprabhu", year: 1486, school: "bhakti", region: "Bengal", ethnicity: "Indian", work: "Śikṣāṣṭakam", others: [], note: "Acintya Bhedābheda; Sankirtana movement."},
    
    // --- LITERATURE & ARTS ---
    {id: "Vidyapati", label: "Vidyāpati", iast: "Vidyāpati", year: 1352, school: "Literature", region: "Mithila", ethnicity: "Indian", work: "Padāvalī", others: ["Kirtilata", "Purusha Pariksha"], note: "The Nightingale of Mithila; Maithili/Bengali poet."},
    {id: "Jayadeva", label: "Jayadeva", iast: "Jayadeva", year: 1200, school: "Literature", region: "Odisha / Bengal", ethnicity: "Indian", work: "Gīta Govinda", others: ["Dasavatara Stotra"], note: "Master of erotic-devotional poetry."},
    {id: "Amir Khusrau", label: "Amir Khusrau", iast: "Amīr Khusrau", year: 1253, school: "Literature", region: "Delhi", ethnicity: "Indian", work: "Qiran-us-Sa'dain", others: ["Tughlaq Nama", "Ghazals"], note: "Parrot of India; Father of Qawwali."},
    
    // --- MODERN ERA (BENGAL RENAISSANCE & OTHERS) ---
    {id: "Ram Mohan Roy", label: "Ram Mohan", iast: "Raja Ram Mohan Roy", year: 1772, school: "Reformer", region: "Bengal", ethnicity: "Indian", work: "Brahmo Samaj", others: ["Precepts of Jesus"], note: "Father of Modern India."},
    {id: "Bankim Chandra", label: "Bankim", iast: "Baṅkim Candra Caṭṭopādhyāya", year: 1838, school: "Literature", region: "Bengal", ethnicity: "Indian", work: "Ānandamaṭh", others: ["Durgeshnandini", "Vande Mataram"], note: "Composer of Vande Mataram."},
    {id: "Michael Madhusudan", label: "Madhusudan", iast: "Michael Madhusudan Dutt", year: 1824, school: "Literature", region: "Bengal", ethnicity: "Indian", work: "Meghnād Badh Kāvya", others: ["Sharmistha"], note: "Tragic epic poet; introduced Sonnet."},
    {id: "Sarat Chandra", label: "Sarat", iast: "Sarat Chandra Chattopadhyay", year: 1876, school: "Literature", region: "Bengal", ethnicity: "Indian", work: "Devdas", others: ["Parineeta", "Srikanta"], note: "Master storyteller of human psychology."},
    {id: "Nazrul", label: "Nazrul", iast: "Kazi Nazrul Islam", year: 1899, school: "Literature", region: "Bengal", ethnicity: "Indian", work: "Bidrohi", others: ["Agnibina", "Sanchita"], note: "The Rebel Poet; fierce anti-colonial voice."},
    {id: "Tagore", label: "Tagore", iast: "Rabindranath Tagore", year: 1861, school: "Literature", region: "Bengal", ethnicity: "Indian", work: "Gītāñjali", others: ["Gora", "Ghare-Baire", "Jana Gana Mana"], note: "Visva-Kavi; Nobel Laureate."},
    {id: "Vivekananda", label: "Vivekānanda", iast: "Swāmī Vivekānanda", year: 1863, school: "advaita", region: "Bengal", ethnicity: "Indian", work: "Rāja Yoga", others: ["Karma Yoga", "Chicago Address"], note: "Brought Vedānta to the global stage."},
    {id: "Aurobindo", label: "Aurobindo", iast: "Sri Aurobindo", year: 1872, school: "yoga", region: "Pondicherry", ethnicity: "Indian", work: "The Life Divine", others: ["Savitri", "Synthesis of Yoga"], note: "Integral Yoga; Supermind."},
    
    // --- INDOPHILES ---
    {id: "Voltaire", label: "Voltaire", iast: "Voltaire", year: 1694, school: "west", region: "France", ethnicity: "French", work: "Essai sur les mœurs", others: ["Fragments on India"], note: "Praised Vedas as oldest wisdom."},
    {id: "Schopenhauer", label: "Schopenhauer", iast: "Arthur Schopenhauer", year: 1788, school: "west", region: "Germany", ethnicity: "German", work: "The World as Will", others: ["Parerga and Paralipomena"], note: "Upanishads were his 'consolation in death'."},
    {id: "Max Muller", label: "Max Müller", iast: "Friedrich Max Müller", year: 1823, school: "west", region: "Germany", ethnicity: "German", work: "Sacred Books of the East", others: ["History of Ancient Sanskrit Literature"], note: "Giant of Philology and Indology."},
    {id: "Tesla", label: "Tesla", iast: "Nikola Tesla", year: 1856, school: "west", region: "USA", ethnicity: "Serbian", work: "AC Current", others: [], note: "Used 'Akasha' and 'Prana' after meeting Vivekananda."},
    {id: "Oppenheimer", label: "Oppenheimer", iast: "J. Robert Oppenheimer", year: 1904, school: "west", region: "USA", ethnicity: "American", work: "Manhattan Project", others: [], note: "Quoted Gita at Trinity: 'I am become Death'."},
    {id: "Eliot", label: "T.S. Eliot", iast: "T.S. Eliot", year: 1888, school: "west", region: "UK", ethnicity: "American", work: "The Waste Land", others: ["Four Quartets"], note: "Ended his masterpiece with 'Shantih Shantih Shantih'."},
    
    // --- ADDED DEITIES (No Timeline) ---
    {id: "Narayana", label: "Nārāyaṇa", iast: "Nārāyaṇa", group: "deity", isDeity: true, note: "Primordial Vishnu"},
    {id: "Brahma", label: "Brahmā", iast: "Brahmā", group: "deity", isDeity: true, note: "Creator"},
    {id: "Shiva", label: "Śiva", iast: "Śiva", group: "deity", isDeity: true, note: "Adi Guru"},
    
    // --- ADDED LINEAGE FIGURES ---
    {id: "Govinda Bhagavatpada", label: "Govinda", iast: "Govinda Bhagavatpāda", year: 750, school: "advaita", region: "Narmada", work: "Yoga Taravali", note: "Guru of Adi Shankara."},
    {id: "Padmapadacharya", label: "Padmapāda", iast: "Padmapādācārya", year: 820, school: "advaita", region: "South", work: "Panchapadika", note: "First Disciple of Shankara."},
    {id: "Hastamalakacharya", label: "Hastāmalaka", iast: "Hastāmalakācārya", year: 820, school: "advaita", region: "South", work: "Hastamalakiya", note: "Disciple of Shankara."},
    {id: "Totakacharya", label: "Toṭaka", iast: "Toṭakācārya", year: 820, school: "advaita", region: "South", work: "Totakashtakam", note: "Disciple of Shankara."},
    {id: "Vasugupta", label: "Vasugupta", iast: "Vasugupta", year: 800, school: "kashmir", region: "Kashmir", work: "Shiva Sutras", note: "Received Shiva Sutras from Shiva."},
    {id: "Somananda", label: "Somānanda", iast: "Somānanda", year: 900, school: "kashmir", region: "Kashmir", work: "Shiva Drishti", note: "Founder of Pratyabhijna."},
    {id: "Kshemaraja", label: "Kṣemarāja", iast: "Kṣemarāja", year: 1000, school: "kashmir", region: "Kashmir", work: "Pratyabhijnahridayam", note: "Disciple of Abhinavagupta."},
    {id: "Nathamuni", label: "Nāthamuni", iast: "Nāthamuni", year: 900, school: "bhakti", region: "Tamil Nadu", note: "First Sri Vaishnava Acharya."},
    {id: "Yamunacharya", label: "Yāmunācārya", iast: "Yāmunācārya", year: 917, school: "bhakti", region: "Tamil Nadu", work: "Siddhitraya", note: "Preceptor of Ramanuja."},
    {id: "Nimbarka", label: "Nimbārka", iast: "Nimbārka", year: 1150, school: "bhakti", region: "Andhra", work: "Vedanta Parijata", note: "Dvaitadvaita Founder."},
    {id: "Vallabhacharya", label: "Vallabha", iast: "Vallabhācārya", year: 1479, school: "bhakti", region: "Charthaval", work: "Anubhashya", note: "Shuddhadvaita Founder."}
];

// --- 2. GURU-SHISHYA LINEAGES (The Nodes that connect) ---
const lineages = [
    // Advaita Lineage
    {s: "Narayana", t: "Brahma", type: "guru"},
    {s: "Brahma", t: "Vashishta", type: "guru"}, // Assume Vashishta exists in extended data or handled
    {s: "Gaudapada", t: "Govinda Bhagavatpada", type: "guru"},
    {s: "Govinda Bhagavatpada", t: "Adi Shankara", type: "guru"},
    {s: "Adi Shankara", t: "Suresvara", type: "guru"},
    {s: "Adi Shankara", t: "Padmapadacharya", type: "guru"},
    {s: "Adi Shankara", t: "Hastamalakacharya", type: "guru"},
    {s: "Adi Shankara", t: "Totakacharya", type: "guru"},
    {s: "Adi Shankara", t: "Vacaspati Misra", type: "influence"}, 
    {s: "Adi Shankara", t: "Vidyaranya", type: "influence"},
    {s: "Adi Shankara", t: "Madhusudana", type: "influence"},
    {s: "Adi Shankara", t: "Vivekananda", type: "lineage"},
    
    // Kashmir Shaivism
    {s: "Shiva", t: "Vasugupta", type: "divine"},
    {s: "Vasugupta", t: "Somananda", type: "lineage"},
    {s: "Somananda", t: "Utpaladeva", type: "guru"},
    {s: "Utpaladeva", t: "Abhinavagupta", type: "grand_guru"},
    {s: "Abhinavagupta", t: "Kshemaraja", type: "guru"},
    
    // Nyaya
    {s: "Gautama Buddha", t: "Nagarjuna", type: "influence"},
    {s: "Nagarjuna", t: "Dignaga", type: "influence"},
    {s: "Dignaga", t: "Udayana", type: "debate"},
    {s: "Udayana", t: "Gangesa", type: "influence"},
    
    // Bhakti
    {s: "Narayana", t: "Nathamuni", type: "inspiration"},
    {s: "Nathamuni", t: "Yamunacharya", type: "grand_guru"},
    {s: "Yamunacharya", t: "Ramanuja", type: "preceptor"},
    {s: "Ramanuja", t: "Madhvacharya", type: "influence"},
    {s: "Jayadeva", t: "Chaitanya", type: "influence"},
    {s: "Chaitanya", t: "Tagore", type: "influence"},
    
    // Indophiles
    {s: "Panini", t: "Voltaire", type: "influence"},
    {s: "Vyasa", t: "Oppenheimer", type: "influence"},
    {s: "Yajnavalkya", t: "Schopenhauer", type: "influence"},
    {s: "Vivekananda", t: "Tesla", type: "meeting"},
    {s: "Patanjali", t: "Vivekananda", type: "influence"}
];

// --- 3. BUILD THE GRAPH ---
let nodes = new vis.DataSet();
let edges = new vis.DataSet();
let allNodes = [];

// Icons/Shapes Mapping
const shapeMap = {
    "advaita": "dot", "nyaya": "triangle", "kashmir": "diamond", "bhakti": "dot",
    "buddhism": "dot", "west": "star", "Literature": "square", "deity": "star"
};

const colorMap = {
    "advaita": "#ff9800", "nyaya": "#00bcd4", "kashmir": "#9c27b0",
    "buddhism": "#e91e63", "west": "#a5a5a5", "Literature": "#4caf50",
    "bhakti": "#ffeb3b", "grammar": "#795548", "Science": "#607d8b", "deity": "#ffd700"
};

// Initialize
rawData.forEach(p => {
    let size = p.isDeity ? 40 : 20;
    let label = p.isDeity ? "★ " + p.label : p.label;
    
    allNodes.push({
        id: p.id,
        label: label,
        group: p.school || p.group,
        value: size,
        color: colorMap[p.school] || colorMap[p.group] || "#ddd",
        shape: shapeMap[p.school] || shapeMap[p.group] || "dot",
        font: { face: 'Noto Serif', color: '#ccc', size: 14 },
        data: p // Store full data
    });
});

// Create Edges
lineages.forEach(l => {
    // Check if nodes exist
    let srcExists = rawData.find(n => n.id === l.s);
    let tgtExists = rawData.find(n => n.id === l.t);
    
    if (srcExists && tgtExists) {
        let color = "#333";
        let dashes = true;
        let label = l.type;
        
        if(l.type === "guru" || l.type === "divine") { color = "#d4af37"; dashes = false; label = "Guru"; }
        if(l.type === "meeting") { color = "#fff"; }
        
        edges.add({ from: l.s, to: l.t, color:{color:color, opacity:0.6}, dashes: dashes, arrows: 'to', label: label, font: {align: 'middle', size: 10, color: '#888', strokeWidth: 0} });
    }
});

nodes.add(allNodes);

// --- 4. RENDERER ---
const container = document.getElementById('mynetwork');
const data = { nodes: nodes, edges: edges };
const options = {
    nodes: { borderWidth: 1, shadow:true },
    edges: { smooth: { type: "continuous" } },
    physics: {
        stabilization: false,
        barnesHut: { gravitationalConstant: -4000, springLength: 200, springConstant: 0.01 }
    },
    interaction: { hover: true, tooltipDelay: 50 }
};
const network = new vis.Network(container, data, options);

// --- 5. TIMELINE (Exclude Deities) ---
const timelineData = new vis.DataSet(rawData.filter(x => !x.isDeity).map((t, i) => ({
    id: i, content: t.label, start: new Date(0).setFullYear(t.year), 
    className: t.school || t.group, nodeId: t.id
})));

const timeline = new vis.Timeline(document.getElementById('mytimeline'), timelineData, {
    height: '100%', stack: true, 
    style: 'background:rgba(17,18,20,0.95); border:none; color:#777',
    start: new Date(0).setFullYear(1800), end: new Date(0).setFullYear(2000)
});

// --- 6. LOGIC: FILTERING & INTERACTIONS ---

// Filter Function
window.filterNetwork = function() {
    const type = document.getElementById('schoolFilter').value;
    
    if (type === 'all') {
        nodes.clear();
        nodes.add(allNodes);
    } else {
        // Show selected school + deities + westerners (for context)
        const schoolNodes = allNodes.filter(n => n.group === type || n.group === 'deity');
        nodes.clear();
        nodes.add(schoolNodes);
    }
}

// Click Interaction
network.on("click", function(params) {
    if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const node = nodes.get(nodeId);
        
        if (node) {
            const d = node.data;
            document.getElementById('p-name').innerText = d.iast; // Use IAST name
            document.getElementById('p-dates').innerText = d.isDeity ? "Timeless / Divine" : (d.date || d.year);
            document.getElementById('p-school').innerText = (d.school || d.group).toUpperCase();
            document.getElementById('p-work').innerText = d.work || "N/A";
            document.getElementById('p-note').innerText = d.note;
            
            // Ethnicity Rendering
            const ethHTML = `<span class="eth-main">${d.ethnicity}</span><span class="eth-sub">${d.region}</span>`;
            document.getElementById('p-ethnicity-container').innerHTML = ethHTML;

            // Render Other Works
            const worksContainer = document.getElementById('p-other-works');
            worksContainer.innerHTML = '';
            if (d.others && d.others.length > 0) {
                d.others.forEach(w => { worksContainer.innerHTML += `<li>${w}</li>`; });
            } else {
                worksContainer.innerHTML = `<li style="color:#555">No other major records listed.</li>`;
            }
            
            // Determine Lineage Text
            let linText = "Independent Thinker";
            if (d.school === 'advaita') linText = "Paramparā: Śaṅkara Lineage";
            if (d.school === 'nyaya') linText = "Paramparā: Mithilā School";
            if (d.isDeity) linText = "Divine Source";
            document.getElementById('p-lineage').innerText = linText;

            // Open Panel
            document.getElementById('side-panel').style.width = "400px";
            document.getElementById('panel-content').style.opacity = "1";
            
            // Sync Timeline (Skip deities)
            if (!d.isDeity) {
                const tItem = timelineData.get({ filter: i => i.nodeId === nodeId });
                if(tItem.length) { timeline.moveTo(tItem[0].start); timeline.setSelection(tItem[0].id); }
            }
        }
    } else {
        document.getElementById('side-panel').style.width = "0";
        document.getElementById('panel-content').style.opacity = "0";
    }
});

// Search
window.searchNode = function() {
    let q = document.getElementById('search').value.toLowerCase();
    if (!q) return;
    let found = allNodes.find(p => p.label.toLowerCase().includes(q) || (p.data.iast && p.data.iast.toLowerCase().includes(q)));
    if (found) {
        // If filtered out, reset filter
        if (!nodes.get(found.id)) {
            document.getElementById('schoolFilter').value = 'all';
            filterNetwork();
        }
        network.selectNodes([found.id]);
        network.focus(found.id, { scale: 1.5, animation: true });
        network.emit("click", { nodes: [found.id] });
    }
}

</script>
</body>
</html>
