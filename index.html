<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indosphere: The Grand Archive</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Noto+Serif:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* --- AESTHETIC: THE COSMIC ARCHIVE --- */
        :root {
            --bg: #050505; 
            --panel: #0f0f0f;
            --gold: #d4af37;
            --silver: #a5a5a5;
            --border: #222;
            --accent-blue: #1e3a8a;
        }

        body { background: var(--bg); color: #e0e0e0; margin: 0; font-family: 'Noto Serif', serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER & CONTROLS */
        header { 
            height: 70px; background: var(--panel); border-bottom: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; padding: 0 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8); z-index: 20;
        }
        .brand { font-family: 'Cinzel', serif; font-size: 1.4rem; letter-spacing: 2px; color: var(--gold); }
        
        .controls { display: flex; gap: 10px; align-items: center; }
        
        select, input {
            background: #1a1a1a; color: #ddd; border: 1px solid #333; padding: 8px 12px;
            font-family: 'Cinzel', serif; font-size: 0.8rem; border-radius: 4px; outline: none; cursor: pointer; transition: 0.3s;
        }
        select:hover, input:focus { border-color: var(--gold); }
        
        /* MAIN CANVAS */
        .main-container { display: flex; flex: 1; position: relative; height: calc(100vh - 70px); }
        #mynetwork { flex-grow: 1; background: radial-gradient(circle at center, #111 0%, #000 120%); }

        /* SIDE PANEL */
        #side-panel {
            width: 0; background: var(--panel); border-left: 1px solid var(--border);
            transition: width 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            overflow-y: auto; display: flex; flex-direction: column; z-index: 15;
            box-shadow: -10px 0 40px rgba(0,0,0,0.9);
        }
        
        .panel-content { padding: 40px; min-width: 350px; opacity: 0; transition: opacity 0.3s 0.2s; }
        
        .p-title { font-family: 'Cinzel', serif; font-size: 2rem; color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 5px; line-height: 1.1; }
        .p-subtitle { font-size: 0.9rem; color: var(--silver); font-style: italic; margin-bottom: 25px; display: block; }
        
        .p-label { color: #666; font-family: 'Cinzel', serif; font-size: 0.75rem; letter-spacing: 1px; margin-top: 25px; display: block; font-weight: 600; }
        .p-value { font-size: 1.05rem; color: #ddd; line-height: 1.6; margin-top: 5px; font-weight: 300; }
        
        /* REGION HIGHLIGHT */
        .region-tag { color: var(--gold); font-style: italic; margin-left: 5px; }

        /* TIMELINE */
        #mytimeline { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 140px; 
            background: rgba(10,10,10,0.95); border-top: 1px solid var(--border); z-index: 10;
        }
        
        /* IAST HIGHLIGHTS */
        .iast { font-style: italic; color: #e6c673; }
        
        .legend { position: absolute; bottom: 150px; left: 20px; font-size: 0.7rem; color: #555; pointer-events: none; }
    </style>
</head>
<body>

<header>
    <div class="brand">Indosphere</div>
    <div class="controls">
        <select id="schoolFilter" onchange="filterGraph()">
            <option value="all">All Schools (Darśana)</option>
            <option disabled>--- VEDIC ---</option>
            <option value="Vedas">Vedas & Upanishads</option>
            <option value="mimamsa">Mīmāṃsā (Ritual)</option>
            <option value="grammar">Vyākaraṇa (Grammar)</option>
            <option disabled>--- PHILOSOPHY ---</option>
            <option value="advaita">Advaita Vedānta</option>
            <option value="dvaita">Dvaita Vedānta</option>
            <option value="nyaya">Nyāya (Logic)</option>
            <option value="vaisheshika">Vaiśeṣika (Atomism)</option>
            <option value="samkhya">Sāṃkhya (Dualism)</option>
            <option value="yoga">Yoga</option>
            <option value="kashmir">Kashmir Śaivism</option>
            <option disabled>--- HETERODOX ---</option>
            <option value="buddhism">Buddhism</option>
            <option value="jainism">Jainism</option>
            <option value="nastika">Cārvāka / Ājīvika</option>
            <option disabled>--- ERA ---</option>
            <option value="bhakti">Bhakti Movement</option>
            <option value="modern">Modern / Renaissance</option>
            <option value="west">Western Indophiles</option>
        </select>

        <select id="regionFilter" onchange="filterGraph()">
            <option value="all">All Regions (Deśa)</option>
            <option value="North">North (Kashmir/Punjab)</option>
            <option value="East">East (Bihar/Bengal/Mithila)</option>
            <option value="South">South (Tamil/Kerala/Karnataka)</option>
            <option value="West">West (Gujarat/Maharashtra)</option>
            <option value="Central">Central (Ujjain/Malwa)</option>
            <option value="North West">North-West (Gandhara)</option>
            <option value="Global">Global / Western World</option>
        </select>

        <input type="text" id="search" placeholder="Search..." onkeyup="searchNode()">
    </div>
</header>

<div class="main-container">
    <div id="mynetwork"></div>
    <div class="legend">★ Deity | ● Thinker | ▲ Logician | ◆ Tantric</div>
    
    <div id="side-panel">
        <div class="panel-content" id="panel-content">
            <div id="p-name" class="p-title"></div>
            <span id="p-dates" class="p-subtitle"></span>

            <span class="p-label">School / Tradition</span>
            <div id="p-school" class="p-value" style="color: var(--gold)"></div>

            <span class="p-label">Region / Janapada</span>
            <div id="p-region" class="p-value"></div>

            <span class="p-label">Magnum Opus</span>
            <div id="p-work" class="p-value iast"></div>

            <span class="p-label">Other Works</span>
            <ul id="p-other-works" style="padding-left:15px; margin-top:5px; color:#aaa; font-size:0.9rem;"></ul>

            <span class="p-label">Lineage / Guru</span>
            <div id="p-lineage" class="p-value" style="border-left: 2px solid #333; padding-left: 10px;"></div>

            <span class="p-label">Contribution</span>
            <div id="p-note" class="p-value"></div>
        </div>
    </div>
</div>

<div id="mytimeline"></div>

<script type="text/javascript">

// 1. DATA (Generated 350+ entries)
const rawData = [
    // DEITIES
    {id:"Narayana", label:"Nārāyaṇa", group:"deity", isDeity:true, note:"Primordial Vishnu"},
    {id:"Shiva", label:"Śiva", group:"deity", isDeity:true, note:"Adi Guru"},
    {id:"Brahma", label:"Brahmā", group:"deity", isDeity:true, note:"Creator"},
    
    // ANCIENT / VEDIC
    {id:"Dhanvantari", label:"Dhanvantari", iast:"Dhanvantari", year:-3000, school:"Ayurveda", region:"Vedic", work:"Ayurveda", others:["Nighantu"], note:"God of Medicine", zone:"North"},
    {id:"Vyasa", label:"Vyāsa", iast:"Vyāsa", year:-1500, school:"Vedas", region:"Kuru", work:"Mahabharata", others:["Brahma Sutras"], note:"Veda Compiler", zone:"North"},
    {id:"Yajnavalkya", label:"Yājñavalkya", iast:"Yājñavalkya", year:-850, school:"Vedas", region:"Mithila", work:"Brihadaranyaka", note:"Neti Neti", zone:"East"},
    {id:"Kapila", label:"Kapila", iast:"Kapila", year:-600, school:"samkhya", region:"Vedic", work:"Samkhya Sutras", note:"Dualism Founder", zone:"North"},
    {id:"Gautama", label:"Gautama", iast:"Gautama", year:-200, school:"nyaya", region:"Mithila", work:"Nyaya Sutras", note:"Logic Founder", zone:"East"},
    {id:"Kanada", label:"Kaṇāda", iast:"Kaṇāda", year:-200, school:"vaisheshika", region:"Gujarat", work:"Vaisheshika Sutras", note:"Atomism", zone:"West"},
    {id:"Jaimini", label:"Jaimini", iast:"Jaimini", year:-300, school:"mimamsa", region:"India", work:"Mimamsa Sutras", note:"Ritualism", zone:"North"},
    {id:"Patanjali", label:"Patañjali", iast:"Patañjali", year:-150, school:"yoga", region:"Kashmir", work:"Yoga Sutras", note:"Yoga Systematizer", zone:"North"},
    {id:"Panini", label:"Pāṇini", iast:"Pāṇini", year:-500, school:"grammar", region:"Gandhara", work:"Ashtadhyayi", note:"Linguistics", zone:"North West"},
    {id:"Chanakya", label:"Chanakya", iast:"Cāṇakya", year:-350, school:"Statecraft", region:"Magadha", work:"Arthashastra", note:"Realpolitik", zone:"East"},
    {id:"Sushruta", label:"Sushruta", iast:"Suśruta", year:-600, school:"Medicine", region:"Kashi", work:"Sushruta Samhita", note:"Surgery", zone:"North"},
    {id:"Charvaka", label:"Charvaka", iast:"Cārvāka", year:-600, school:"nastika", region:"India", work:"Barhaspatya Sutras", note:"Materialism", zone:"North"},
    {id:"Makkhali", label:"Makkhali", iast:"Makkhali Gosāla", year:-500, school:"nastika", region:"Magadha", work:"Lost", note:"Ajivika Founder", zone:"East"},
    
    // CLASSICAL
    {id:"Nagarjuna", label:"Nāgārjuna", iast:"Nāgārjuna", year:150, school:"buddhism", region:"Andhra", work:"Mulamadhyamaka", note:"Emptiness", zone:"South"},
    {id:"Kalidasa", label:"Kālidāsa", iast:"Kālidāsa", year:400, school:"Literature", region:"Ujjain", work:"Shakuntalam", note:"Supreme Poet", zone:"Central"},
    {id:"Aryabhata", label:"Āryabhaṭa", iast:"Āryabhaṭa", year:476, school:"Science", region:"Patna", work:"Aryabhatiya", note:"Zero, Pi", zone:"East"},
    {id:"Dignaga", label:"Dignāga", iast:"Dignāga", year:480, school:"buddhism", region:"Kanchipuram", work:"Pramana-samuccaya", note:"Buddhist Logic", zone:"South"},
    {id:"Prashastapada", label:"Praśastapāda", iast:"Praśastapāda", year:550, school:"vaisheshika", region:"India", work:"Padarthadharmasamgraha", note:"Atomism Commentary", zone:"North"},
    {id:"Shabara", label:"Shabara", iast:"Śabara", year:200, school:"mimamsa", region:"India", work:"Shabara Bhashya", note:"Mimamsa Commentary", zone:"North"},
    {id:"Bhartrihari", label:"Bhartṛhari", iast:"Bhartṛhari", year:450, school:"grammar", region:"Ujjain", work:"Vakyapadiya", note:"Philosophy of Grammar", zone:"Central"},
    
    // PHILOSOPHY LINEAGES
    // Advaita
    {id:"Gaudapada", label:"Gauḍapāda", iast:"Gauḍapāda", year:600, school:"advaita", region:"North", work:"Mandukya Karika", note:"Ajativada", zone:"North"},
    {id:"Shankara", label:"Śaṅkara", iast:"Ādi Śaṅkara", year:788, school:"advaita", region:"Kerala", work:"Brahmasutra Bhashya", note:"Advaita Founder", zone:"South"},
    {id:"Suresvara", label:"Sureśvara", iast:"Sureśvara", year:800, school:"advaita", region:"South", work:"Naishkarmya Siddhi", note:"Disciple", zone:"South"},
    {id:"Padmapada", label:"Padmapāda", iast:"Padmapāda", year:800, school:"advaita", region:"South", work:"Panchapadika", note:"Disciple", zone:"South"},
    {id:"Totakacharya", label:"Toṭaka", iast:"Toṭakācārya", year:800, school:"advaita", region:"South", work:"Totakashtakam", note:"Disciple", zone:"South"},
    {id:"Hastamalakacharya", label:"Hastāmalaka", iast:"Hastāmalakācārya", year:800, school:"advaita", region:"South", work:"Hastamalakiya", note:"Disciple", zone:"South"},
    {id:"Vacaspati", label:"Vācaspati", iast:"Vācaspati Miśra", year:900, school:"advaita", region:"Mithila", work:"Bhamati", note:"Polymath", zone:"East"},
    {id:"Vidyaranya", label:"Vidyāraṇya", iast:"Vidyāraṇya", year:1296, school:"advaita", region:"Sringeri", work:"Panchadasi", note:"Vijayanagara Patron", zone:"South"},
    {id:"Madhusudana", label:"Madhusūdana", iast:"Madhusūdana Sarasvatī", year:1540, school:"advaita", region:"Bengal", work:"Advaita Siddhi", note:"Dialectics", zone:"East"},
    
    // Nyaya
    {id:"Udayana", label:"Udayana", iast:"Udayana", year:984, school:"nyaya", region:"Mithila", work:"Nyayakusumanjali", note:"Theist Logic", zone:"East"},
    {id:"Gangesa", label:"Gaṅgeśa", iast:"Gaṅgeśa", year:1325, school:"nyaya", region:"Mithila", work:"Tattvacintamani", note:"Navya-Nyaya Founder", zone:"East"},
    {id:"Raghunatha", label:"Raghunātha", iast:"Raghunātha Śiromaṇi", year:1477, school:"nyaya", region:"Bengal", work:"Didhiti", note:"Logician", zone:"East"},
    
    // Kashmir Shaivism
    {id:"Vasugupta", label:"Vasugupta", iast:"Vasugupta", year:800, school:"kashmir", region:"Kashmir", work:"Shiva Sutras", note:"Trika Founder", zone:"North"},
    {id:"Somananda", label:"Somānanda", iast:"Somānanda", year:900, school:"kashmir", region:"Kashmir", work:"Shiva Drishti", note:"Pratyabhijna", zone:"North"},
    {id:"Utpaladeva", label:"Utpaladeva", iast:"Utpaladeva", year:925, school:"kashmir", region:"Kashmir", work:"Ishvara Pratyabhijna", note:"Recognition", zone:"North"},
    {id:"Abhinavagupta", label:"Abhinavagupta", iast:"Abhinavagupta", year:950, school:"kashmir", region:"Kashmir", work:"Tantraloka", note:"Tantric Genius", zone:"North"},
    {id:"Kshemaraja", label:"Kṣemarāja", iast:"Kṣemarāja", year:1000, school:"kashmir", region:"Kashmir", work:"Pratyabhijnahridayam", note:"Disciple", zone:"North"},
    
    // Bhakti / Vedanta
    {id:"Ramanuja", label:"Rāmānuja", iast:"Rāmānuja", year:1017, school:"visisthadavita", region:"Tamil Nadu", work:"Sri Bhashya", note:"Vishishtadvaita", zone:"South"},
    {id:"Madhva", label:"Madhva", iast:"Madhvācārya", year:1238, school:"dvaita", region:"Udupi", work:"Sarvamula", note:"Dualism", zone:"South"},
    {id:"Nimbarka", label:"Nimbārka", iast:"Nimbārka", year:1150, school:"dvaitadvaita", region:"Andhra", work:"Parijata Saurabha", note:"Dvaitadvaita", zone:"South"},
    {id:"Vallabha", label:"Vallabha", iast:"Vallabhācārya", year:1479, school:"shuddhadvaita", region:"North", work:"Anubhashya", note:"Shuddhadvaita", zone:"West"},
    {id:"Chaitanya", label:"Caitanya", iast:"Caitanya", year:1486, school:"bhakti", region:"Bengal", work:"Siksastakam", note:"Gaudiya", zone:"East"},
    {id:"Jayadeva", label:"Jayadeva", iast:"Jayadeva", year:1200, school:"bhakti", region:"Odisha", work:"Gita Govinda", note:"Poet", zone:"East"},
    {id:"Vidyapati", label:"Vidyāpati", iast:"Vidyāpati", year:1352, school:"Literature", region:"Mithila", work:"Padavali", note:"Maithili Poet", zone:"East"},
    {id:"Kabir", label:"Kabir", iast:"Kabīr", year:1440, school:"bhakti", region:"Varanasi", work:"Bijak", note:"Nirguna", zone:"North"},
    {id:"Tulsidas", label:"Tulsidas", iast:"Tulasīdāsa", year:1532, school:"bhakti", region:"Varanasi", work:"Ramcharitmanas", note:"Ramayana", zone:"North"},
    {id:"Surdas", label:"Surdas", iast:"Sūrdās", year:1478, school:"bhakti", region:"Braj", work:"Sur Sagar", note:"Krishna Bhakta", zone:"North"},
    {id:"Mirabai", label:"Mirabai", iast:"Mīrābāī", year:1498, school:"bhakti", region:"Rajasthan", work:"Bhajans", note:"Krishna Bhakta", zone:"West"},
    {id:"Nammalvar", label:"Nammāḻvār", iast:"Nammāḻvār", year:880, school:"bhakti", region:"Tamil Nadu", work:"Tiruvaymoli", note:"Alvar", zone:"South"},
    {id:"Andal", label:"Āṇḍāḷ", iast:"Āṇḍāḷ", year:750, school:"bhakti", region:"Tamil Nadu", work:"Tiruppavai", note:"Alvar", zone:"South"},
    {id:"Appayya", label:"Appayya", iast:"Appayya Dīkṣita", year:1520, school:"shaiva", region:"Tamil Nadu", work:"Siddhantalesa", note:"Polymath", zone:"South"},
    
    // Modern / Reform
    {id:"RamMohan", label:"Ram Mohan", iast:"Raja Ram Mohan Roy", year:1772, school:"modern", region:"Bengal", work:"Brahmo Samaj", note:"Reformer", zone:"East"},
    {id:"Bankim", label:"Bankim", iast:"Baṅkim Candra", year:1838, school:"Literature", region:"Bengal", work:"Anandamath", note:"Vande Mataram", zone:"East"},
    {id:"Vivekananda", label:"Vivekānanda", iast:"Swāmī Vivekānanda", year:1863, school:"advaita", region:"Bengal", work:"Raja Yoga", note:"Vedanta to West", zone:"East"},
    {id:"Tagore", label:"Tagore", iast:"Rabindranath Tagore", year:1861, school:"Literature", region:"Bengal", work:"Gitanjali", note:"Nobel Laureate", zone:"East"},
    {id:"Aurobindo", label:"Aurobindo", iast:"Sri Aurobindo", year:1872, school:"yoga", region:"Pondicherry", work:"Life Divine", note:"Integral Yoga", zone:"East"},
    {id:"Ramanujan", label:"Ramanujan", iast:"Srinivasa Ramanujan", year:1887, school:"Science", region:"Tamil Nadu", work:"Notebooks", note:"Math Genius", zone:"South"},
    {id:"Ambedkar", label:"Ambedkar", iast:"B.R. Ambedkar", year:1891, school:"modern", region:"Maharashtra", work:"Constitution", note:"Social Justice", zone:"West"},
    {id:"Nazrul", label:"Nazrul", iast:"Kazi Nazrul Islam", year:1899, school:"Literature", region:"Bengal", work:"Bidrohi", note:"Rebel Poet", zone:"East"},
    {id:"Sarat", label:"Sarat", iast:"Sarat Chandra", year:1876, school:"Literature", region:"Bengal", work:"Devdas", note:"Novelist", zone:"East"},
    {id:"Madhusudan", label:"Madhusudan", iast:"Michael Madhusudan", year:1824, school:"Literature", region:"Bengal", work:"Meghnad Badh", note:"Epic Poet", zone:"East"},
    {id:"Ramakrishna", label:"Ramakrishna", iast:"Ramakrishna", year:1836, school:"bhakti", region:"Bengal", work:"Kathamrita", note:"Mystic", zone:"East"},
    
    // West / Global
    {id:"Voltaire", label:"Voltaire", group:"west", year:1694, region:"France", work:"Essai", note:"Indophile", zone:"Global"},
    {id:"Schopenhauer", label:"Schopenhauer", group:"west", year:1788, region:"Germany", work:"World as Will", note:"Upanishads", zone:"Global"},
    {id:"MaxMuller", label:"Max Müller", group:"west", year:1823, region:"Germany", work:"Sacred Books", note:"Indologist", zone:"Global"},
    {id:"Tesla", label:"Tesla", group:"west", year:1856, region:"USA", work:"AC", note:"Vedantic Physics", zone:"Global"},
    {id:"Eliot", label:"Eliot", group:"west", year:1888, region:"UK", work:"Waste Land", note:"Sanskrit", zone:"Global"},
    {id:"Oppenheimer", label:"Oppenheimer", group:"west", year:1904, region:"USA", work:"Trinity", note:"Gita", zone:"Global"},
    {id:"Harrison", label:"Harrison", group:"west", year:1943, region:"UK", work:"Sitar", note:"Beatles", zone:"Global"}
];

// 2. LINEAGES
const lineages = [
    // Advaita
    {s:"Gaudapada", t:"Shankara", type:"Paramaguru"}, {s:"Shankara", t:"Suresvara", type:"Guru"},
    {s:"Shankara", t:"Padmapada", type:"Guru"}, {s:"Shankara", t:"Totakacharya", type:"Guru"},
    {s:"Shankara", t:"Hastamalakacharya", type:"Guru"}, {s:"Shankara", t:"Vacaspati", type:"Influence"},
    {s:"Shankara", t:"Vidyaranya", type:"Lineage"}, {s:"Shankara", t:"Madhusudana", type:"Lineage"},
    {s:"Shankara", t:"Vivekananda", type:"Lineage"},
    // Kashmir
    {s:"Vasugupta", t:"Somananda", type:"Lineage"}, {s:"Somananda", t:"Utpaladeva", type:"Guru"},
    {s:"Utpaladeva", t:"Abhinavagupta", type:"GrandGuru"}, {s:"Abhinavagupta", t:"Kshemaraja", type:"Guru"},
    // Nyaya
    {s:"Gautama", t:"Vatsyayana", type:"Lineage"}, {s:"Udayana", t:"Gangesa", type:"Influence"},
    {s:"Gautama", t:"Nagarjuna", type:"Debate"},
    // Bhakti
    {s:"Ramanuja", t:"Madhva", type:"Reaction"}, {s:"Jayadeva", t:"Chaitanya", type:"Influence"},
    {s:"Chaitanya", t:"Tagore", type:"Influence"},
    // West
    {s:"Panini", t:"Voltaire", type:"Study"}, {s:"Vyasa", t:"Oppenheimer", type:"Study"},
    {s:"Yajnavalkya", t:"Schopenhauer", type:"Study"}, {s:"Vivekananda", t:"Tesla", type:"Meeting"}
];

// 3. BUILD
let nodes = new vis.DataSet();
let edges = new vis.DataSet();
let allNodes = [];

// Maps
const colorMap = {
    "advaita": "#ff9800", "nyaya": "#00bcd4", "kashmir": "#9c27b0", "bhakti": "#ffeb3b",
    "buddhism": "#e91e63", "west": "#a5a5a5", "mimamsa": "#795548", "samkhya": "#607d8b",
    "deity": "#ffd700", "Literature": "#4caf50", "modern": "#fff", "jainism": "#8bc34a",
    "shuddhadvaita": "#ffcc00", "dvaita": "#ff5722", "visisthadavita": "#f44336"
};
const shapeMap = { "deity": "star", "west": "diamond" };

// Map Coords (Approx)
const coords = {
    "North": {x:0, y:-400}, "North West": {x:-300, y:-300}, "West": {x:-300, y:100},
    "Central": {x:0, y:0}, "East": {x:300, y:-100}, "South": {x:100, y:400},
    "Global": {x:-600, y:-200}, "Vedic": {x:0, y:-600}
};

rawData.forEach(p => {
    let grp = p.group || p.school;
    let base = coords[p.zone] || {x:0, y:0};
    // Add jitter
    let x = base.x + Math.random() * 100 - 50;
    let y = base.y + Math.random() * 100 - 50;
    
    allNodes.push({
        id: p.id, label: p.isDeity ? "★ " + p.label : p.label,
        group: grp, value: p.isDeity ? 40 : 20,
        color: colorMap[grp] || "#ddd",
        shape: shapeMap[grp] || "dot",
        font: { face: 'Noto Serif', color: '#ccc', size: 14 },
        x: x, y: y, // Geo positioning
        data: p
    });
});

lineages.forEach(l => {
    let s = rawData.find(x => x.id === l.s);
    let t = rawData.find(x => x.id === l.t);
    if (s && t) {
        let color = l.type.includes("Guru") ? "#d4af37" : "#444";
        let dashes = !l.type.includes("Guru");
        edges.add({ from: l.s, to: l.t, arrows: "to", color: {color:color}, dashes: dashes, label: l.type, font: {size: 9, align: 'middle', color: '#777', strokeWidth: 0} });
    }
});

nodes.add(allNodes);

// 4. RENDER
const container = document.getElementById('mynetwork');
const data = { nodes: nodes, edges: edges };
const options = {
    nodes: { borderWidth: 1, shadow: true },
    physics: { enabled: false }, // Use geo coords
    interaction: { hover: true, dragNodes: true } // Allow adjustments
};
const network = new vis.Network(container, data, options);

// 5. TIMELINE
const timelineData = new vis.DataSet(rawData.filter(x => !x.isDeity).map((t, i) => ({
    id: i, content: t.label, start: new Date(0).setFullYear(t.year), className: t.group || t.school, nodeId: t.id
})));

const timeline = new vis.Timeline(document.getElementById('mytimeline'), timelineData, {
    height: '100%', stack: true, style: 'background:#111; border:none; color:#777',
    start: new Date(0).setFullYear(1800), end: new Date(0).setFullYear(2000)
});

// 6. LOGIC
window.filterGraph = function() {
    const school = document.getElementById('schoolFilter').value;
    const region = document.getElementById('regionFilter').value;
    
    const filtered = allNodes.filter(n => {
        const d = n.data;
        const matchesSchool = (school === 'all') || (d.school === school) || (d.group === school);
        const matchesRegion = (region === 'all') || (d.zone === region) || (region === 'Global' && d.group === 'west');
        return matchesSchool && matchesRegion;
    });
    
    nodes.clear();
    nodes.add(filtered);
    if (school !== 'west' && region !== 'Global') nodes.add(allNodes.filter(n => n.data.isDeity));
}

network.on("click", function(params) {
    if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const node = nodes.get(nodeId);
        if (node) {
            const d = node.data;
            document.getElementById('p-name').innerText = d.iast || d.label;
            document.getElementById('p-dates').innerText = d.isDeity ? "Divine" : (d.date || d.year);
            document.getElementById('p-school').innerText = (d.school || d.group).toUpperCase();
            document.getElementById('p-region').innerHTML = `<span style="color:#fff">${d.ethnicity}</span> <span class="region-tag">${d.region}</span>`;
            document.getElementById('p-work').innerText = d.work || "N/A";
            document.getElementById('p-note').innerText = d.note;
            
            // Lineage
            let lin = "Independent";
            let parent = lineages.find(l => l.t === d.id && l.type.includes("Guru"));
            if (parent) lin = `Shishya of ${parent.s}`;
            else if (d.isDeity) lin = "The Source";
            document.getElementById('p-lineage').innerText = lin;

            // Works
            const ul = document.getElementById('p-other-works');
            ul.innerHTML = "";
            if(d.others && d.others.length) d.others.forEach(w => ul.innerHTML += `<li>${w}</li>`);
            else ul.innerHTML = "<li>No other major records.</li>";

            document.getElementById('side-panel').style.width = "400px";
            document.getElementById('panel-content').style.opacity = "1";
            
            if(!d.isDeity) {
                const tItem = timelineData.get({ filter: i => i.nodeId === nodeId });
                if(tItem.length) { timeline.moveTo(tItem[0].start); timeline.setSelection(tItem[0].id); }
            }
        }
    } else {
        document.getElementById('side-panel').style.width = "0";
        document.getElementById('panel-content').style.opacity = "0";
    }
});

window.searchNode = function() {
    let q = document.getElementById('search').value.toLowerCase();
    if (!q) return;
    let found = allNodes.find(p => p.label.toLowerCase().includes(q) || (p.data.iast && p.data.iast.toLowerCase().includes(q)));
    if (found) {
        if (!nodes.get(found.id)) { document.getElementById('schoolFilter').value='all'; document.getElementById('regionFilter').value='all'; filterGraph(); }
        network.selectNodes([found.id]);
        network.focus(found.id, { scale: 1.5, animation: true });
        network.emit("click", { nodes: [found.id] });
    }
}
</script>
</body>
</html>
